# Google Colabの使い方とPythonの基礎 [(HTML)](https://kaityo256.github.io/python_zero/hello/)

## 本講の目的

* Google Colabの使い方に慣れる
* Pythonに触れてみる

## Google Colabの動作確認

本稿では、Google Colaboratory、略してGoogle Colab(グーグル・コラボ)を使ってPythonを学ぶ。Google ColabはGoogleによるクラウドに用意されたJupyterノートブーク環境であり、ブラウザさえあればPythonが実行できる。この環境が完全に無料で使えるというのだから恐れ入る。まずはGoogle Colabの簡単な使い方を学ぼう。以下、Googleアカウントは持っているものと仮定する。

まず、Googleにログインした状態で、[Google Colabのウェブサイト](https://colab.research.google.com)にアクセスする。Googleアカウントの優先言語が日本語になっていれば日本語で表示されると思うが、もし英語で表示されたら、アカウント設定で日本語に設定する。稀に日本語に設定してもGoogle ColabやGoogle Driveのメニューが日本語にならない場合がある。その際は一度、英語などの別の言語に設定してから日本語に戻すとうまく設定されるようだ。

正しくアクセスできると、以下のようなウェルカムメニューが表示される。

![fig/colab_welcome.png](fig/colab_welcome.png)

ここで「PYTHON 3の新しいノートブック」をクリックしよう。Untitled0.ipynbという名前のファイルが作成され、入力待ちとなる。

![fig/colab_newnote.png](fig/colab_newnote.png)

この三角の矢印のある行に、なにか入力してみよう。たとえば「3+5」と入力し、「三角ボタンをクリック」するか、「シフトキーを押しながらリターン」を入力する。以下、この動作を「実行する」と呼ぶ。

![fig/colab_firstcode.png](fig/colab_firstcode.png)

矢印がしばらくくるくる回ってから、\[1\]という表記に変わり、答えである8が表示されたと思う。これは

* 「3+5」というPythonのコードがクラウドに送信され
* クラウドでPythonが実行され
* その結果である8が表示された

ということが起きている。

Jupyterノートブックは、「セル」と呼ばれる単位で編集を行う。先程入力した「3+5」と、結果の「8」がまとめて一つのセルである。実行後、新たな「セル」が作られ、入力待ちになっている。そこに「a = 12345」と入力して、また実行してみよう。

![fig/colab2.png](fig/colab2.png)

こんどは何も実行結果が出力されない。これは「aという変数を作成し、そこに12345という値を代入せよ」という意味だ。これにより「a」という変数に「12345」という整数の値が記憶されている。これを表示してみよう。次のセルに「print(a)」と入力して実行せよ。

![fig/colab3.png](fig/colab3.png)

「12345」という表示が得られたはずである。変数の値を表示するだけなら、「print」は不要である。左上の「+ コード」と書かれたところをクリックし、出てきたセルに「a」とだけ入力して実行せよ。やはり「12345」という表示が得られたはずである。

さて、ここまでで5つのセルができたはずである。これらは自由に編集、再実行することができる。\[2\]の「a=12345」を修正し、「a=6789」として実行してみよう。その後、4番の「print(a)」や5番の「a」のセルを実行し、出力が変わることを確認せよ。

不要なセルは削除することができる。セルの右側のメニューから「セルの削除」を選ぶとセルが削除できる。また、上段のメニューの「↑ セル」や「↓ セル」で、セルの順番を入れ替えることもできる。

## 簡単な描画プログラム

Google Colab上で、簡単な描画プログラムを作成、実行してみよう。現在開いているノートブックに上書きしても良いが、現在開いているノートを閉じて、新たに作成しよう。
まず、「ファイル」メニューの「ゴミ箱に移動」をクリックする。「ノートブックをゴミ箱に移動」というダイアログが出てくるので「COLABORATORY に戻る」を選ぶ。するとまたメニュー画面が出てくるので「PYTHON3の新しいノートブック」をクリックしよう。新しいノートブックが開かれるはずである。今後、ノートが混乱してどうにもならなくなったら、この手順で新しいノートブックを作成すること。

新しいノートブックができたら、最初のセルに以下のプログラムを書いて実行しよう。

```py
from PIL import Image, ImageDraw
import IPython
```

これは、イメージ描画ライブラリを利用するよ、という宣言である。`import`文については後で学ぶので、今は気にしなくて良い。

次のセルに、以下のプログラムを入力して実行してみよう。

```py
im = Image.new("RGB", (256, 256))
draw = ImageDraw.Draw(im)
cx = 128
cy = 128
r = 64
draw.ellipse((cx - r, cy - r, cx + r, cy + r), outline=(255, 255, 255))
```

`draw.ellipse`は、指定された二つの座標を左上と右下とする長方形に接する楕円を描く命令である。今回は正方形を入力しているので円を描く命令となっている。正しく入力されていればエラーは出ないはずだが、エラーが出たら、実行してエラーがでなくなるまで修正、実行を繰り返そう。

エラーが出なくなったら、３つ目のセルに以下を入力し、実行せよ。

```py
im.save("test.png")
IPython.display.Image("test.png")
```

これまで正しく入力していれば、黒字に白い丸が表示されたはずである。エラーが出たり、うまく表示されなかったら、入力したセルの内容を見直そう。

## プログラムの修正

Jupyterノートブックは、すでに入力済みのセルを修正することができる。

まず、一番目のセルを以下のように修正し、実行せよ。

```py
from PIL import Image, ImageDraw
import IPython
from math import pi, sin, cos
```

三行目に、`math`ライブラリから円周率、sin、cos関数を使うよ、という宣言を追加した。

さらに、二番目のセルの円を描く命令の直後に、以下のようにプログラムを追加しよう。

```py
im = Image.new("RGB", (256, 256))
draw = ImageDraw.Draw(im)
cx = 128
cy = 128
r = 64
draw.ellipse((cx - r, cy - r, cx + r, cy + r), outline=(255, 255, 255))
# ↓ここから追加 (このコメントは入力しなくて良い)
n = 5
t = 2.0 * pi / n * (n // 2)
for i in range(n):
  s1 = t*i
  s2 = s1+t
  x1 = r*cos(s1)+cx
  y1 = r*sin(s1)+cy
  x2 = r*cos(s2)+cx
  y2 = r*sin(s2)+cy
  draw.line((x1,y1,x2,y2),fill=(255,255,255))
```

`for i in range(n):`の行を入力して改行すると、カーソルの位置が少し右にずれたはずである(行末のコロンを忘れないこと)。これを **インデント** と呼ぶ。インデントは、プログラムの階層構造を視覚的に表現するのに使われる **工夫** であったが、Pythonはそれを言語仕様として取り込んだ。以下、`s1 = t*i`から`draw.line((x1,y1,x2,y2),fill=(255,255,255))`までは、同じインデントのレベルに記載すること。そのまま入力していけば正しいインデントになるが、もしずれた場合には、一度左の空白をすべて消してからタブキーを一度押せば正しいインデントになる。

二つ目のセルの入力が終わったら実行してみよう。この時点ではまだ何も表示されない。

さて、一つめのセルの`import`文、二つめのセルの描画プログラムが完成し、それぞれ正しく実行できたら、最後に三つ目のセルを実行してみよう。こちらは修正しないでそのまま再実行すれば良い。実行するには、クリックして三つ目のセルにフォーカスを移してから三角マークをクリックするか、シフト+リターンを入力する。ただしく実行できていれば、「黒字に白い丸」のイメージに、五芒星が表示されたはずである。

### 課題1

先の二つめのセルの`n = 5`の値を7や9に変えて実行してみよ。51などと大きな値にするとどうなるだろう？また、このプログラムは`n`が偶数の時にはうまく描画できない。プログラムの動作原理を推測し、なぜ偶数で動かないのか考えてみよ。

### 任意課題

先のプログラムを`n = 6`のときに六芒星が描かれるように修正せよ。ヒント：三角形をずらして二つ描画せよ。

## ロジスティック写像

より実践的な描画プログラムの例として、ロジスティック写像の描画プログラムを作ってみよう。

### 課題2-1

新しいノートブックに以下のプログラムを入力し、実行せよ。三つのセルに分けて入力し、それぞれ実行すること。

一つめのセル。

```py
import matplotlib.pyplot as plt
import numpy as np
```

二つめのセル。インデントのレベルが3階層あるので入力に注意。

```py
loop = 1000
loop2 = 900
rs, re = 1.0, 3.0
n = 1000
x = []
y = []
for i in range(n):
    r = (re-rs)*i/n + rs
    v = 0.1
    for j in range(loop):
        v = r*v*(1.0-v)
        if j > loop2:
            x.append(r)
            y.append(v)
```

三つめのセル。

```py
nx = np.array(x)
ny = np.array(y)
plt.scatter(nx, ny, s=0.1)
```

正しく入力できていれば、最後のセルの実行終了後に以下のような画面が出力されるはずである。

![fig/logistic.png](fig/logistic.png)

### 課題2-2

描画範囲は二つ目のセルの以下の場所で指定されている。

```py
rs, re = 1.0, 3.0
```

これを、

```py
rs, re = 1.0, 4.0
```

と修正し、再度実行して何が表示されるか確認せよ。

```py
rs, re = 3.5, 4.0
```

ではどうか。

### 課題2-3

matplotlibはプロットのためのライブラリである。表示する領域は`plt.ylim([ys,ye])`の形で指定できる。

まずは二番目のセルの領域指定を

```py
rs, re = 1, 4
```

として実行し、三番目のセルも実行して画像を表示させよ。

次に、二番目のセルを

```py
rs, re = 3.54, 3.58
```

と修正して実行した上で、「+ コード」により四番目のセルを追加し、そこに

```py
nx = np.array(x)
ny = np.array(y)
plt.ylim([0.335,0.39])
plt.scatter(nx, ny, s=0.1)
```

と入力して実行せよ。二つ目の画像が表示されるはずである。二つのグラフを見てどう思うか考えよ。

## 余談：タッチタイピングについて

今後どうなるかはわからないが、少なくとも現時点において最速の情報入力デバイスはキーボードであろう。今後もしばらく重要な入力インターフェースとしてキーボードが使われる見込みである。さて、キーボードを使って情報を入力するためには、指でキーを叩かなければならない。この時、キーボードを見ないでキーを叩くことを「タッチタイピング」と呼ぶ。この講義を受けている人で、もしまだタッチタイピングができない人がいたら、絶対にマスターしたほうが良い。よく誤解されるが、タッチタイピングは「キーをすばやく叩く」ためのものではない。もちろんキー入力は早いに越したことはないが、それより重要な役目は **キー入力で肩が凝らないようにする** ことである。今後、どのような職業につくにせよ、その多くはパソコンを使った作業を伴うであろう。この時、正しくない姿勢で打鍵したり、ディスプレイとキーボードの間を忙しく視線移動しながら打鍵していると、そのうちひどい肩凝りに悩まされるようになる。肩凝りに悩まされながら知的作業を行うのはかなり困難である。キーボードの「F」と「J」のキーを見よ。小さな突起があり、手で触ってわかるようになっているであろう。左右の人差し指を「F」と「J」のキーに置くことを「ホームポジション」という。そこから様々なキーを「見ないで」打鍵するのがタッチタイピングである。早く打鍵するのではなく、ゆっくり正確に、手の重さを机に逃がすことを意識しながら打鍵するように心がけよう。一週間も練習すればタッチタイピングできるようになり、一生その恩恵を受けることができる。タッチタイピングは絶対にマスターする価値がある技術の一つである。