# 条件分岐と繰り返し処理2 [(HTML)](https://kaityo256.github.io/python_zero/while/)

* 前回の復習
* 変数とは何か？
* while文
* コラッツ問題

## 前回の復習

* 基本型
* 条件分岐
* 繰り返し処理
* 関数
* インデントによるブロック表現

## 変数とは何か？

TODO: idやtypeの説明

## While文

「10回繰り返したい」という場合にはfor文が使えるが、「ある条件が満たされている限り繰り返したい」という場合もあるだろう。そんなときに使えるのがwhile文である。while文は以下のような構文になる。

```py
while 条件:
    処理
```

例えば、ある変数が正である限り1をひきながら表示するプログラムは以下のようになる。

```py
a = 10
while a > 0:
    print(a)
    a -= 1
```

実はPythonでは、整数は0で無い限り「真」、「0」は「偽」として扱われるため、以下のようにも書ける。

```py
a = 10
while a:
    print(a)
    a -= 1
```

## ループのスキップ(continue)

## ループの脱出(break)

TODO: continueとbreakを使った課題を考えること。

## コラッツ問題

ではさっそくwhile文を使ってプログラムを作ってみよう。題材としてコラッツ問題(Collatz problem)を取り上げる。
コラッツ問題とは、以下のようなものである。

* 何か正の整数を考えよ
* それが偶数なら2で割れ
* それが奇数なら3倍して1を足せ
* 以上の処理を数字が1になるまでずっと繰り返せ

たとえば「5」を考えよう。これは奇数なので3倍して1を足すと「16」になる。
これは偶数だから2で割って「8」、さらに2で割って「4」「2」「１」となる。

コラッツ問題とは「上記の手続きを繰り返した場合、すべての整数について有限回の手続きで1になるか？」というものであり、現在も解決されていない。もし有限の手続きで1にならないとしたら、どこかに無限に大きくなるか、ループする構造があるはずだが、今の所どちらも見つかっていない。

### 課題1

与えられた数字に対して、

* 偶数なら2でわる
* 奇数なら3倍して1を足す

という処理を、その数字が1になるまで繰り返しながら表示する関数`コラッツ`を作りたい。
以下の空欄を埋めよ。

```py
de collatz(i):
  print(i)
  while (条件1):
    if (条件2):
      i = i //2
    else:
      i = i * 3 + 1
    print(i)
```

インデントに注意。最初の`print`と二番目の`print`はインデントの位置が異なる。

完成したら、関数を入力したセルを実行してから、別のセルに以下のように関数呼び出しを入力、実行し、結果が一致することを確認せよ。

```py
コラッツ(3)
```

```sh
3
10
5
16
8
4
2
1
```

いろいろな数字を入れて、すべて最終的に1になることを確認せよ。収束するまでの手続きが長い数を探せ。例えば27を入れたらどうなるか。

### 課題2

コラッツ問題をグラフで可視化してみよう。新しいノートブックを開き、以下のプログラムを4つのセルにわけて入力せよ。

1つ目のセル。

```py
from graphviz import Digraph
import IPython
```

2つ目のセル。

```py
def collatz(i, edges):
    while (条件1):
        j = i
        if (条件2):
            i = i // 2
        else:
            i = i * 3 + 1
        edges.add((j, i))
```

3つ目のセル。

```py
def make_graph(n):
    g = Digraph(format='png')
    edges = set()
    for i in range(1, n+1):
        コラッツ(i, edges)
    for i, j in edges:
        g.edge(str(i), str(j))
    g.graph_attr.update(size="10,10")
    g.render("test")
```

4つ目のセル。

```py
make_graph(3)
IPython.display.Image("test.png")
```

成功したら、いろんな数字を`make_graph`に入れて実行してみよ。20ぐらいがちょうどよいと思うが、27に挑戦してもよい。コラッツ予想とは、このグラフが木構造、つまりループ構造が無いことを主張するものである。

### 課題3

コラッツ予想には様々な変種がある。例えば、

* 何か正の整数を考えよ
* それが偶数なら2で割れ
* それが奇数なら3倍して **3** を足せ
* 以上の処理を数字が **1か3** になるまでずっと繰り返せ

というものである。これもやはり有限回の手順で止まるらしい(おそらくこちらも未解決問題)。これを確認してみよう。

まず、先程課題2で作成した課題に名前をつけて保存しよう。ファイルメニューから「名前を変更」をクリック、もしくは上の「Untitled.ipynb」をクリックし、「collatz.ipynb」と名前を変えよう。その後、「ファイル」メニューの「保存」を選ぶと保存される。

この状態で「ファイル」メニューから「ドライブで探す」をクリックせよ。「マイドライブ」の「Colab Notebooks」に「collatz.ipynb」があるはずである。それを右クリックし「コピーを作成」を選ぶと「collatz.ipynbのコピー」というファイルが作成されるので、それを右クリックして「名前を変更」を選び、「collatz2.ipynb」という名前にしよう。「collatz2.ipynb」が作成されたら、右クリック→「アプリで開く」→「Colaboratory」を選ぶことで開くことができる。

「collatz2.ipynb」がGoogle Colabで開かれたら、

* 数字が1か3になったら終了とする
* 奇数だったら3倍して3を足す

となるように修正せよ。

修正したら、例えば`make_graph(5)`として、1に収束する数字と3に収束する数字があることを確認せよ。
`make_graph(50)`ではどうなるか？1に収束するのはどういう数字か？

## 余談：数論について

コラッツ予想に代表されるような、「整数がこの条件を満たすか？」のような問いを扱うのが整数論(数論)である。一般に数論は「問いを理解するのは易しいが、その解決は極めて難しい」という性質を持つ。
ガウスの「数学は科学の女王であり、数論は数が置くの女王である」という言葉は有名だ。
数論の中でも特に有名なのは「フェルマーの最終定理」であろう。これは「三以上の自然数nについて、x^n + y^n = z^nを満たす自然数の組(x,y,z)は存在しない」という定理である。フェルマーはフランスの弁護士であったが、余暇に行った数学で大きな功績を残し、「数論の父」とも呼ばれる。彼は趣味でディオファントスの著作「算術」の注釈本を読み、その余白に有名な注釈を書き込んだ。その多くは後に証明、もしくは反証されたが、一つだけ証明も反証もされずに残ったのが「フェルマーの最終定理」である。フェルマーが「フェルマーの最終定理」を記述した横に「私はこの定理の驚くべき証明を手に入れたが、ここに書くには余白が足りない」と書いたのは有名である。この問題を解決したアンドリュー・ワイルズは、7年の間、秘密裏にこの問題に取り組み、1995年に解決した。フェルマーによる提唱から証明に至るまで、実に360年かかっている。数論の面白さは、整数しか扱わないにもかかわらず、そこに幾何や解析がからんでくることである。
数論は入門しやすく、一方で極めて奥が深いため、その難しさ、美しさに魅せられて人生を捧げる人も多い。2011年5月にコラッツの弟子が「コラッツ予想を解決した」という論文を投稿した。しかし、すぐに証明の不備が見つかり、6月に撤回された。その[論文](https://preprint.math.uni-hamburg.de/public/papers/hbam/hbam2011-09.pdf)には、

> The reasoning on p. 11, that "The set of all vertices (2n,l) in all levels will contain all even numbers 2n ≧ 6 exactly once." has turned out to be incomplete. Thus, the statement “that the collatz conjecture is true” has to be withdrawn, at least temporarily.

適当な和訳。

> 「11ページにある証明は不完全であることがわかった。したがって、『コラッツ予想は真である』という主張は、今のところは撤回する」

とある。最後の「at least temporarily (今のところは)」に悔しさがにじむ。サイモン・シンは、こうした数学の未解決問題へ取り憑かれることを熱病に例えた。フェルマーの最終定理に取り憑かれるフェルマー熱、ポアンカレ予想に取り憑かれるポアンカレ熱などが有名だが、この二つは近年解決した。しかし、コラッツ予想は未解決であり、今後もコラッツ熱の感染者を生み続けるのであろう。

このような数学の話に興味のある人は「数学を作った人々 (E. T. Bell著、田中 勇、銀林 浩 訳)」をおすすめする。数学という、一種無味乾燥にも思える学問の構築の裏に、様々な人間ドラマがあったことを知れば、数学を学ぶ楽しさも増えるに違いない。