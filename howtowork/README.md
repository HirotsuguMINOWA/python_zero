# Pythonが動く仕組み

* コンピュータはなぜ動くのか？
* Pythonが動く仕組み
* 抽象構文木
* dis.dis
* 仮想マシンハック

## プログラムが実行される仕組み

ブラウザ上で入力したプログラムが実行され、その結果を受け取った。Pythonのプログラムはクラウド上で実行されたが、そのブラウザを実行しているのはローカルなPCである。では、そもそもプログラムとはどうやって動いているのだろうか？せっかくプログラミングを覚えるのだから、計算機がどういう仕組みで動いているのか知っておいた方が良いだろう。なお、私は古い人間なので、コンピュータのことをどうしても「計算機」と呼んでしまう。以後、パソコンやCPUなどを指して「計算機」と呼ぶのでそのつもりでいて欲しい。

いま、目の前にある計算機は、ディスプレイ(表示装置)、キーボードやマウス(入力装置)、CPU(計算装置)、メモリ(記憶装置)などから構成されている。ディスクなどのストレージやネットワークなどの通信装置については今は忘れよう。このうちCPUがもっとも重要な装置であるが、やっていることは非常に単純で、

* メモリから命令とデータを取ってくる
* 命令を解釈し、データを演算器に投げる
* 演算器から返ってきた結果をメモリに書き戻す

ということをひたすら繰り返しているに過ぎない。「命令」も一種のデータであり、メモリに置いてあることに注意しよう。さて、計算機が解釈できるのは数字だけである。したがって、人間が計算機に命令するためには、機械語(マシン語)と呼ばれる数字の羅列を使う必要がある。しかし、機械語を手で書くのは非常に面倒なので、人間が理解できる形式でプログラムを書き、それを計算機が理解できる形式に変換してやる必要がある。その「人間が理解できる形式」がプログラム言語と呼ばれるものである。

プログラム言語には、大きく分けてコンパイル言語とインタプリタの二種類がある。C++などはコンパイル言語の代表格的な言語である。コンパイラと呼ばれるプログラムが、人間の書いたプログラムをあらかじめ全て機械語に翻訳してから実行する。インタプリタとは、人間の書いたコードを逐次的に解釈しながら実行する方式であり、Pythonもインタプリタに属す。しかし、プログラムをそのまま解釈、実行すると遅いため、Pythonは「バイトコード」と呼ばれる中間形式を出力し、それを実行することで高速化を図る。バイトコードを実行するプログラムを仮想マシン(Virtual Machine, VM)と呼ぶ。

TODO: VMの説明。Javaとの比較など

TODO: dis.disによるバイトコードの確認

TODO: レジスタマシン、スタックマシンの説明もする？高度すぎか？