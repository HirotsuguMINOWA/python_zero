# 乱数を使ったプログラム

* 疑似乱数とは
* モンティパイソン問題
* パーコレーション
* 迷路
* 余談：確率の難しさ

## 疑似乱数とモンテカルロ法

### 疑似乱数とは

乱数とは、ランダムな数のことである。例えばサイコロをふると、1から6までの数字がほぼ等確率で出ると期待される(実際には少しずれるらしい)。
さて、計算機でもランダムな数字が必要になることがある。例えばゲームで低確率で出る「会心の一撃」や「痛恨の一撃」を表現するのに乱数が必要だ。
レアなモンスターを出現させるのも乱数が必要である。しかし、計算機において「真の乱数列」を表現するのは難しい。
「真の乱数列」とは、これまでの数列から、次の数字が予想できないような数列のことである。
現在の計算機は決定論的に動作するため、同じ入力を与えると同じ結果を出力する。
このような計算機で用いられる乱数は「疑似乱数」と呼ばれる。疑似乱数とは、一見乱数列のように見えるが実は規則性があり、
これまでの乱数列から次の乱数が予想できてしまうものだ。

以下のコードを書いて実行してみよう。

```py
import random

for i in range(10):
    print(random.randint(0,10))
```

実行するたびに結果が異なるだろう。しかし、以下のようにしてみよう。

```py
import random

random.seed(1)
for i in range(10):
    print(random.randint(0,10))
```

何度実行しても、同じ乱数列が得られることがわかるであろう。これは乱数の「種」を固定したためだ。

TODO:乱数生成の説明

## モンテカルロ法

乱数を利用してシミュレーションをしたり、何かを計算したりする方法を「モンテカルロ法」と呼ぶ。

TODO: モンテカルロ法の説明

今回は、モンテカルロ法を使って様々なプログラムを組んでみよう。

## モンティ・ホール問題

モンティ・ホール問題とは、アメリカの番組の中で行われた、あるゲームに由来する。そのゲームとはこういうものである。

* 三つの箱が用意され、その中に一つだけ商品が入っており、残りの二つは空である。
* プレイヤーは、そのうちの一つを選ぶ
* 司会者は、選ばれなかった二つの箱の中身を確認し、空であるほうの箱を開ける
* その上で司会者はプレイヤーに「選んだ箱を変えてよい」という
* さて、プレイヤーは選んだ箱を変えたほうが得だろうか？それとも確率は変わらないだろうか？

TODO: 図解

この問題は有名なので、答えを知っている人も多いだろう。しかし、ここは答えを全く知らないとして、シミュレーションをしよう。

## パーコレーション

札幌の市街のような、碁盤の目のような道路があるとしよう。ところがある日、大雪が降って、道がところどころ通行止めになってしまった。
いま、道が通行可能な確率をpとしよう。通行可能な道だけを通って「こっち側」から「向こう側」に渡れる確率(Crossing Probability)$C$は
確率pの関数となる。p=0の場合、通行可能な道が全くないのだから絶対に渡れない。したがって$C(0)=0$である。
また、p=1なら、すべての道が通行可能だから、絶対に向こう側に渡ることができる。すなわち$C(1)=1$である。
また、pが大きいほど、渡れる確率も大きくなると考えられる。
では、具体的に$C(p)$はどんな関数になるだろうか？この問題は「パーコレーション」と呼ばれ、相転移を示す最も簡単なもののひとつである。
「道路を渡れるかどうか」はボンド・パーコレーションと呼ばれるモデルになるが、プログラムがやや面倒になので、以下に述べる「サイト・パーコレーション」についてシミュレーションしてみよう。

いま、正方形に区切られたパネルがあるとする。その区画が、確率pで通行可能、1-pで通行不可だとしよう。
通行人は、かつ上下左右につながった、通行可能なパネルのみ渡ることができる。「こちら側」から「向こう側」にわたることができる確率は、pに対してどう振る舞うだろうか？

### 状態の生成

### Union-Findアルゴリズム

## 迷路

せっかくUnion-Findアルゴリズムを学んだので、それを別の問題に応用してみよう。ここでは迷路作成アルゴリズムにUnion-Findアルゴリズムを使ってみる。

TODO: クラスタリングによる迷路生成の説明

## 余談：確率の難しさ

確率が絡んだ問題は、時として直観と合わない結果を生む。そんな問題は(厳密にはパラドックスではないが)パラドックスと呼ばれる。
有名なのは「誕生日のパラドックス」であろう。今、うるう年は考えず、一年が365日だとしよう。また、誕生日は一様であるとする。
さて、30人いるクラスで、誕生日が同じペアが存在する確率はどのくらいだろうか？
ちょっと想像してから、こんなコードを書いて確認してみよう。

```py
def p(n):
    r = 1.0
    for i in range(n):
        r *= (365-i)/365
    return 1.0 - r

p(30)
```

思ったより大きかったのではないだろうか？逆に、直観より確率が小さいことを「悪用」する例としては「コンプガチャ」と呼ばれる景品がある。
これは「絵合わせ」もしくは「カード合わせ」と呼ばれる古典的なギャンブルであり、

* 複数種類の絵柄のあるカードがあり、お金を払うとそのどれかがランダムで手に入る
* 複数の絵柄をすべて揃えたら、景品が当たる

というものである。例えば、カードが10種類あり、一枚100円とする。全種類揃えるのに必要な経費の期待値はどのくらいか、すぐにわかるだろうか？
やはり少し想像してから計算してみよう。

```py
def p(n):
    r = 0.0
    for i in range(n):
        r += n/(i+1)
    return r

p(10)
```

「10種類ある絵柄が等確率で当たり、10種類揃えたら景品を渡す」という文面に嘘がなく、確率操作などをせずその通りに実施するとしても、これは違法となる。なぜ違法とすべきなのか、考えてみると面白いであろう。

モンティ・ホール問題でも、直観と乖離した結果に多くの人が騙された。間違った人々の中には数学者もいて、新聞に意見を投書して紹介され、のちに恥をかいたようだ。現在はネット社会であり、何か肩書を持った人が間違ったことを言うと多くの人の目に触れ、昔より炎上しやすい。この問題が教えてくれる本当の教訓は「何か発言するときは気を付けよう」ということかもしれない。